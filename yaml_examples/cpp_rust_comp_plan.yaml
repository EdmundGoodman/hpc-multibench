#defaults:
#  "default name":
executables:
  "cpp_reference":
    sbatch_config:
      "nodes": 1
      "ntasks-per-node": 1
      "cpus-per-task": 1
      "mem-per-cpu": 3700
    module_loads:
      - "GCC/11.3.0"
    environment_variables: {}
    directory: "../0_cpp_versions/0_ref"
    build_commands:
      - "make -j 8"
    run_command: "./test_HPCCG"

  "cpp_openmp":
    sbatch_config:
      "nodes": 1
      "ntasks-per-node": 1
      "cpus-per-task": 16
      "mem-per-cpu": 3700
    module_loads:
      - "GCC/11.3.0"
    environment_variables:
      "OMP_NUM_THREADS": 16
    directory: "../0_cpp_versions/1_openmp"
    build_commands:
      - "make -j 8"
    run_command: "./test_HPCCG"

  "cpp_mpi":
    sbatch_config:
      "nodes": 2
      "ntasks-per-node": 8
      "cpus-per-task": 1
      "mem-per-cpu": 3700
    module_loads:
      - "GCC/11.3.0"
      - "OpenMPI/4.1.4"
    environment_variables: {}
    directory: "../0_cpp_versions/2_mpi"
    build_commands:
      - "make -j 8"
    run_command: "mpirun -n 2 ./test_HPCCG"

  "cpp_hybrid":
    sbatch_config:
      "nodes": 2
      "ntasks-per-node": 4
      "cpus-per-task": 2
      "mem-per-cpu": 3700
    module_loads:
      - "GCC/11.3.0"
      - "OpenMPI/4.1.4"
    environment_variables:
      "OMP_NUM_THREADS": 2
    directory: "../0_cpp_versions/3_hybrid"
    build_commands:
      - "make -j 8"
    run_command: "mpirun -n 2 ./test_HPCCG"

  "rust_reference":
    sbatch_config:
      "nodes": 1
      "ntasks-per-node": 1
      "cpus-per-task": 1
      "mem-per-cpu": 3700
    module_loads:
      - "GCC/11.3.0"
      - "Clang/13.0.1"
    environment_variables: {}
    directory: "../5_iterators"
    build_commands:
      - "cargo build --release"
    run_command: "cargo run --release"

  "rust_rayon":
    sbatch_config:
      "nodes": 1
      "ntasks-per-node": 1
      "cpus-per-task": 16
      "mem-per-cpu": 3700
    module_loads:
      - "GCC/11.3.0"
      - "Clang/13.0.1"
    environment_variables:
      "OMP_NUM_THREADS": 16
    directory: "../6_parallel"
    build_commands:
      - "cargo build --release"
    run_command: "cargo run --release"

  "rust_mpi":
    sbatch_config:
      "nodes": 2
      "ntasks-per-node": 8
      "cpus-per-task": 1
      "mem-per-cpu": 3700
    module_loads:
      - "GCC/11.3.0"
      - "Clang/13.0.1"
      - "OpenMPI/4.1.4"
    environment_variables: {}
    directory: "../6_mpi"
    build_commands:
      - "cargo build --release"
    run_command: "mpirun -n 2 cargo run --release"

benches:
  "cpp_rust_comp":
    executables:
      # - "cpp_reference"
      # - "cpp_openmp"
      - "cpp_mpi"
      # - "cpp_hybrid"
      #- "rust_reference"
      # - "rust_rayon"
      - "rust_mpi"
    matrix:
      - args:
        #- "50 50 50"
        #- "100 100 100"
        - "200 200 200"
