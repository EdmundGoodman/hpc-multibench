run_configurations:
  "cpp-openmp":
    sbatch_config:
      "nodes": 1
      "ntasks-per-node": 1
      "cpus-per-task": 16
      "exclusive": "mcs"
      "mem": 60000
    module_loads: []
    environment_variables:
      "OMP_NUM_THREADS": 16
    directory: "../0_cpp_versions/1_openmp"
    build_commands:
      - "make no_yaml"
      - "make -j 8"
    run_command: "./test_HPCCG"

  "cpp-hybrid":
    sbatch_config:
      "nodes": 1
      "ntasks-per-node": 2
      "cpus-per-task": 8
      "exclusive": "mcs"
      "mem": 60000
    module_loads:
      - "cs402-mpi"
    environment_variables:
      "OMP_NUM_THREADS": 8
    directory: "../0_cpp_versions/3_hybrid"
    build_commands:
      - "make no_yaml"
      - "make -j 8"
    run_command: "mpirun ./test_HPCCG"

  "rust-rayon":
    sbatch_config:
      "nodes": 1
      "ntasks-per-node": 1
      "cpus-per-task": 16
      "exclusive": "mcs"
      "mem": 60000
    module_loads: []
    environment_variables:
      "RAYON_NUM_THREADS": 16
    directory: "../6_parallel"
    build_commands:
      - "cargo build --release"
    run_command: "./target/release/hpccg-rs"

  "rust-hybrid":
    sbatch_config:
      "nodes": 1
      "ntasks-per-node": 2
      "cpus-per-task": 8
      "exclusive": "mcs"
      "mem": 60000
    module_loads:
      - "cs402-mpi"
    environment_variables:
      "RAYON_NUM_THREADS": 8
    directory: "../8_hybrid"
    build_commands:
      - "cargo build --release"
    run_command: "mpirun ./target/release/hpccg-rs"

  "cpp-kokkos":
    sbatch_config:
      "nodes": 1
      "ntasks-per-node": 1
      "cpus-per-task": 16
      "exclusive": "mcs"
      "mem": 60000
    module_loads: []
    environment_variables:
      "OMP_NUM_THREADS": 16
      "OMP_PROC_BIND": "spread"
      "OMP_PLACES": "threads"
    directory: "../0_cpp_versions/5_kokkos"
    build_commands:
      - "make no_yaml"
      - "make -j 8"
    run_command: "./test_HPCCG"

  "cpp-kokkos-mpi":
    sbatch_config:
      "nodes": 1
      "ntasks-per-node": 2
      "cpus-per-task": 8
      "exclusive": "mcs"
      "mem": 60000
    module_loads:
      - "cs402-mpi"
    environment_variables:
      "OMP_NUM_THREADS": 8
      "OMP_PROC_BIND": "spread"
      "OMP_PLACES": "threads"
    directory: "../0_cpp_versions/6_kokkos_mpi"
    build_commands:
      - "make no_yaml"
      - "make -j 8"
    run_command: "mpirun ./test_HPCCG"

benches:
  "cpp-kokkos-rust":
    run_configurations:
      - "cpp-openmp"
      - "cpp-hybrid"
      - "cpp-kokkos"
      - "cpp-kokkos-mpi"
      - "rust-rayon"
      - "rust-hybrid"
    matrix:
      args:
        - "100 200 200"
        - "150 200 200"
        - "200 200 200"
        - "250 200 200"
        - "300 200 200"
    analysis:
      metrics:
        "Mesh x size": "nx: (\\d+)"
        "Wall time (s)": "real\\s([\\d\\.]+)\nuser"
      line_plots:
        - title: "C++, Kokkos, and Rust Version Comparison"
          x: "Mesh x size"
          y: "Wall time (s)"
      bar_charts:
        - title: "C++, Kokkos, and Rust Version Comparison"
          y: "Wall time (s)"
          fix_metrics:
            "Mesh x size": 150

  "omp-proc-bind":
    enabled: False
    run_configurations:
      - "cpp-openmp"
      - "cpp-hybrid"
      - "cpp-kokkos"
      - "cpp-kokkos-mpi"
    matrix:
      args:
        - "200 200 200"
      environment_variables:
        - "OMP_PROC_BIND": "spread"
          "OMP_PLACES": "threads"
        - "OMP_PROC_BIND": ""
          "OMP_PLACES": ""
    analysis:
      metrics:
        "Mesh x size": "nx: (\\d+)"
        "Wall time (s)": "real\\s([\\d\\.]+)\nuser"
        "OMP_PROC_BIND": "=== RUN INSTANTIATION ===\n\\{.*environment_variables: \\{.*OMP_PROC_BIND: (\\w*),.*\\}"
      bar_charts:
        - title: "C++, Kokkos, and Rust Version Comparison"
          x: "Mesh x size"
          y: "Wall time (s)"
          split_metrics:
            - "OMP_PROC_BIND"
