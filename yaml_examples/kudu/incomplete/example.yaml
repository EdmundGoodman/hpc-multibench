run_configurations:
  "cpp-hybrid":
    sbatch_config:
      "nodes": 1
      "ntasks-per-node": 16
      "cpus-per-task": 2
      "exclusive": "mcs"
      "mem-per-cpu": 1500
    module_loads:
      - "cs402-mpi"
    environment_variables:
      "OMP_NUM_THREADS": 2
    directory: "../0_cpp_versions/3_hybrid"
    build_commands:
      - "make -j 8"
    run_command: "mpirun ./test_HPCCG"

benches:
  "strong-scaling":
    run_configurations:
      - "cpp-hybrid"
    matrix:
      [args, run_command]:
        - ["64 64 1024", "mpirun -np 1 ./test_HPCCG"]
        - ["64 64 512", "mpirun -np 2 ./test_HPCCG"]
        - ["64 64 256", "mpirun -np 4 ./test_HPCCG"]
        - ["64 64 128", "mpirun -np 8 ./test_HPCCG"]
        - ["64 64 64", "mpirun -np 16 ./test_HPCCG"]
    analysis:
      metrics:
        "Mesh z size": "nz: (\\d+)"
        "MPI Ranks": "=== RUN INSTANTIATION ===\n\\{.*run_command: mpirun -np (\\d+).*\\}"
        "Total time (s)": "Time Summary:[\\s\\S]*Total\\s*: ([\\d\\.]+)[\\s\\S]*\nFLOPS Summary"
        "Wall time (s)": "real\\s([\\d\\.]+)\nuser"
      line_plots:
        - title: "Strong Scaling Plot"
          x: "Mesh z size"
          y: "Wall time (s)"
      # roofline_plots:
      #   - title: "Strong Scaling Roofline"
      #     gflops_per_sec: "Mesh z size"
      #     flops_per_byte: "Total time (s)"
      # bar_charts:
      #   - title: "Strong Scaling Chart"
      #     y: "Total time (s)"
      # exports:
      #   - filename: "./export.csv"
      #     metrics:
      #       - "Mesh z size"
      #       - "Total time (s)"



  "weak-scaling":
    enabled: False
    run_configurations:
      - "cpp-hybrid"
    matrix:
      args:
        - "64 64 64"
      run_command:
        - "mpirun -np 1 ./test_HPCCG"
        - "mpirun -np 2 ./test_HPCCG"
        - "mpirun -np 4 ./test_HPCCG"
        - "mpirun -np 8 ./test_HPCCG"
        - "mpirun -np 16 ./test_HPCCG"
    analysis:
      metrics:
        "MPI Ranks": "=== RUN INSTANTIATION ===\n\\{.*run_command: mpirun -np (\\d+).*\\}"
        "Total time (s)": "Time Summary:[\\s\\S]*Total\\s*: ([\\d\\.]+)[\\s\\S]*\nFLOPS Summary"
        "Wall time (s)": "real\\s([\\d\\.]+)\nuser"
      line_plots:
        - title: "Weak Scaling Plot"
          x: "MPI Ranks"
          y: "Wall time (s)"
