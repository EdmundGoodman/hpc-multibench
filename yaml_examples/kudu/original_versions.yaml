run_configurations:
  "cpp-reference":
    sbatch_config:
      "nodes": 1
      "ntasks-per-node": 1
      "cpus-per-task": 16
      "exclusive": "mcs"
      "mem": 60000
    module_loads: []
    environment_variables: {}
    directory: "../0_cpp_versions/0_ref"
    build_commands:
      - "make no_yaml"
      - "make -j 8"
    run_command: "./test_HPCCG"

  "cpp-openmp":
    sbatch_config:
      "nodes": 1
      "ntasks-per-node": 1
      "cpus-per-task": 16
      "exclusive": "mcs"
      "mem-per-cpu": 1875
    module_loads: []
    environment_variables:
      "OMP_NUM_THREADS": 16
    directory: "../0_cpp_versions/1_openmp"
    build_commands:
      - "make no_yaml"
      - "make -j 8"
    run_command: "./test_HPCCG"

  "cpp-mpi":
    sbatch_config:
      "nodes": 2
      "ntasks-per-node": 1
      "cpus-per-task": 2
      "exclusive": "mcs"
      "mem": 60000
    module_loads:
      - "cs402-mpi"
    environment_variables: {}
    directory: "../0_cpp_versions/2_mpi"
    build_commands:
      - "make no_yaml"
      - "make -j 8"
    run_command: "mpirun ./test_HPCCG"

  "cpp-hybrid":
    sbatch_config:
      "nodes": 2
      "ntasks-per-node": 1
      "cpus-per-task": 32
      "exclusive": "mcs"
      "mem": 60000
    module_loads:
      - "cs402-mpi"
    environment_variables:
      "OMP_NUM_THREADS": 32
    directory: "../0_cpp_versions/3_hybrid"
    build_commands:
      - "make no_yaml"
      - "make -j 8"
    run_command: "mpirun ./test_HPCCG"


benches:
  "original-versions":
    run_configurations:
      - "cpp-reference"
      - "cpp-openmp"
      - "cpp-mpi"
      - "cpp-hybrid"
    reruns:
      number: 5
      highest_discard: 1
      lowest_discard: 1
    matrix:
      args:
        - "100 100 100"
        - "150 150 150"
        - "200 200 200"
        - "250 250 250"
        - "300 300 300"
    analysis:
      metrics:
        "Mesh x size": "nx: (\\d+)"
        "Total time (s)": "Time Summary:[\\s\\S]*Total\\s*: ([\\d\\.]+)[\\s\\S]*\nFLOPS Summary"
        "Wall time (s)": "real\\s([\\d\\.]+)\nuser"
      line_plots:
        - title: "C++ Versions Comparison"
          x: "Mesh x size"
          y: "Wall time (s)"
